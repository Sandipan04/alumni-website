<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-5">

    <h2 class="mb-4">Alumni Admin Panel</h2>

    <div id="login-section" class="card p-4 mx-auto" style="max-width: 400px;">
        <h4>Login</h4>
        <input type="email" id="email" class="form-control mb-2" placeholder="Admin Email">
        <input type="password" id="password" class="form-control mb-2" placeholder="Password">
        <button id="btnLogin" class="btn btn-primary w-100">Login</button>
    </div>

    <div id="dashboard-section" style="display:none;">
        <button id="btnLogout" class="btn btn-danger btn-sm mb-4">Logout</button>
        
        <div class="card p-4 bg-light">
            <h5>Add New Student</h5>
            <div class="row g-2">
                <div class="col-md-4"><input type="text" id="inBatch" class="form-control" placeholder="Batch (e.g. Int. MSc 2020)"></div>
                <div class="col-md-4"><input type="text" id="inName" class="form-control" placeholder="Full Name"></div>
                <div class="col-md-4"><input type="text" id="inSupervisor" class="form-control" placeholder="Supervisor"></div>
                <div class="col-md-6"><input type="text" id="inPos" class="form-control" placeholder="Position"></div>
                <div class="col-md-6"><input type="text" id="inInst" class="form-control" placeholder="Institute"></div>
                <div class="col-md-6"><input type="text" id="inEmail" class="form-control" placeholder="Email"></div>
                <div class="col-md-6"><input type="text" id="inPhoto" class="form-control" placeholder="Photo URL (Link only)"></div>
            </div>
            <button id="btnSave" class="btn btn-success mt-3">Add to Database</button>
        </div>
        
        <div id="msg" class="mt-3"></div>
    </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // PASTE SAME CONFIG HERE
  const firebaseConfig = { apiKey: "AIzaSyD...", /* ... rest of config ... */ };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // 1. Auth Listener: Toggles UI based on login status
  onAuthStateChanged(auth, (user) => {
    if (user) {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('dashboard-section').style.display = 'block';
    } else {
        document.getElementById('login-section').style.display = 'block';
        document.getElementById('dashboard-section').style.display = 'none';
    }
  });

  // 2. Login Logic
  document.getElementById('btnLogin').addEventListener('click', () => {
    const e = document.getElementById('email').value;
    const p = document.getElementById('password').value;
    signInWithEmailAndPassword(auth, e, p).catch(err => alert(err.message));
  });

  // 3. Logout Logic
  document.getElementById('btnLogout').addEventListener('click', () => signOut(auth));

  // 4. Save Data Logic
  document.getElementById('btnSave').addEventListener('click', async () => {
    try {
        await addDoc(collection(db, "students"), {
            batch: document.getElementById('inBatch').value,
            name: document.getElementById('inName').value,
            supervisor: document.getElementById('inSupervisor').value,
            position: document.getElementById('inPos').value,
            institute: document.getElementById('inInst').value,
            email: document.getElementById('inEmail').value,
            photo: document.getElementById('inPhoto').value,
            createdAt: new Date()
        });
        document.getElementById('msg').innerHTML = `<div class="alert alert-success">Saved! Check the homepage.</div>`;
    } catch (e) {
        console.error(e);
        alert("Error saving. Do you have permission?");
    }
  });
</script>
</body>
</html>
